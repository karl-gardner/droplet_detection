Author: Karl Gardner<br>PhD Candidate, Department of Chemical Engineering ([Dr. Wei Li](https://www.depts.ttu.edu/che/research/li-lab/)), Texas Tech University
<br><br>
![ttu_chemical](https://user-images.githubusercontent.com/91646805/154190573-53e361f6-7c60-4062-b56b-7cbd11d39fc4.jpg)

# Droplet Detection Model




<div align="center">
  <a href="https://colab.research.google.com/github/karl-gardner/droplet_detection/blob/master/yolov3.ipynb">
  <img src="https://img.shields.io/badge/-YOLOv3-blue?logo=googlecolab&logoWidth=18&labelColor=grey" alt="hello"/></a>
  
  <a href="https://colab.research.google.com/github/karl-gardner/droplet_detection/blob/master/yolov5.ipynb">
  <img src="https://img.shields.io/badge/-YOLOv5-blue?logo=googlecolab&logoWidth=18&labelColor=grey" alt="hello"/></a><br>
  
  <a href="https://colab.research.google.com/github/karl-gardner/droplet_detection/blob/master/yolov5.ipynb">
  <img src="https://img.shields.io/badge/-YOLOv5-blue?logo=data:image/png;base64,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&logoWidth=18&labelColor=red" alt="hello"/></a><br>
  
Artificial Intelligence (AI) is becoming increasingly useful in numerous microfluidic platforms for biomedical applications. Although other researchers have introduced machine learning models for droplet generation and classification of mixing in droplets, automatic detection of droplets with cell encapsulation has not been explored, which hinders the implication of AI in droplet microfluidics for single cell-based applications.  You Only Look Once (YOLO), an influential class of object detectors, has had several improvements since the original publication by Joseph Redmon in 2016. This paper investigates the application of both YOLOv3 and YOLOv5 object detectors in the development of an automated droplet and cell detector. In the procedure, a droplet bounding box is predicted, then cropped from the original image for the individual cells to be detected through a separate model for full examination. The system includes a production set for additional performance analysis with Poisson statistics while providing a full experimental workflow with both droplet and cell models. The droplet generator employed contains an expansion chamber allowing for visualization of cell-encapsulated droplets with a digital camera. The training set is collected and preprocessed before labeling and applying image augmentations, allowing for a generalizable object detector. The mean average precision (mAP) is utilized as a validation and test set metric to investigate the model performance while individual predictions are explored to gather a deeper understanding of the results. Furthermore, it is demonstrated that droplet enumeration from the YOLOv3 model is consistent with hand counted ratios and the Poisson distribution, confirming that the platform can be used in real-time experiments for cell encapsulation optimization.
</div>

![workflow](https://user-images.githubusercontent.com/91646805/156113705-35f9fa1e-6913-4ecb-bc1b-c4979e2d7acf.jpg)


<details>
<summary>Instructions (click to expand)</summary>
<br>

1) First create a folder in your google drive account called droplet_classification (This step is important in order to keep the directories in check)
2) Use this link: https://drive.google.com/drive/folders/1Oo68HSdU-jzcBAEr0yeRuzuSxoprEP_D?usp=sharing to access the shared google drive folder
3) At the top there will be a dropdown arrow after the folder location (Shared with me > data_files): click on this dropdown arrow
4) Click on the "Add shortcut to Drive" button then navigate to inside your droplet_classification folder and click the blue "Add Shortcut" button.  This will add a shortcut to the shared google drive folder in your droplet_classification folder.
5) Open the yolov3 colab notebook from the colab badge provided, then click "Save a copy in Drive" under File > Save a copy in Drive.  Do the same for the provided yolov5 colab notebook.
6) This will save the two notebooks in the "Colab Notebooks" folder in your google drive.  Move these two notebooks to the droplet_classification folder and rename them yolov3.ipynb and yolov5.ipynb respectively in order for the directories to be correct.  The final droplet_classification folder should look like this:<img width="720" alt="image" src="https://user-images.githubusercontent.com/91646805/148874654-890a5d94-f9e9-4273-bcd8-318df44feca4.png">

7) Click the link here for the droplet model dataset: https://universe.roboflow.com/karl-gardner-kmk9u/pc3dropletdetection2/6 and you will see two datasets (No_Augmentation and final_dataset).  Start with the final_dataset and click on "Download" in the upper right corner.  Then, click "Sign in with Github" and follow the prompts to allow roboflow to sign in with github.  Or you may create a different account with roboflow.  Then, the download link will bring you to a pop up that says Export.  For the "Format" click on the YOLO v5 PyTorch and "show download code" on the bottom.  You will then see a link that you can use to enter in the colab notebook.  The final page should look like this but with your own link under the red stripe: <img width="925" alt="image" src="https://user-images.githubusercontent.com/91646805/149068681-5d5529b4-7d6f-41f5-8710-98f04c780654.png"> Then copy this link into the section of both notebooks (yolov3.ipynb and yolov5.ipynb) that says "Curl droplet data from roboflow > Data with Augmentation for Training > [ROBOFLOW-API-KEY]": ![image](https://user-images.githubusercontent.com/91646805/151044698-1d03e6c8-7d2b-401c-b632-b00d1fbe6821.png)  Copy your download link inside of the double quaotations as in the red box in the image provided.

8) Repeat step 7 for the droplet dataset with no augmentations (No_Augmentation): ![image](https://user-images.githubusercontent.com/91646805/151045660-a4fb9e26-a108-4369-aba9-63be2bb9efc1.png)

9) Repeat steps 7 and 8 with the cell dataset in the link provided: https://universe.roboflow.com/karl-gardner-kmk9u/cropped_drops2/1.  This dataset only needs to be copied into the yolov3.ipynb notebook since it is not used in the yolov5.ipynb notebook.
10) You can now use both notebooks to perform more testing or contribute to the project.  You can find the code written for many of the figures in the final paper: DOI Website
</details>

<details>
<summary>Contributions (click to expand)</summary><br>

 **Publication Authors:**<br>Karl Gardner, Md Mezbah Uddin, Linh Tran, Thanh Pham, Siva Vanapalli, and Wei Li<br><br>
 
 **Publication Acknowledgements:**<br>WL acknowledge support from National Science Foundation (CBET, Grant No. 1935792) and National Institute of Health (IMAT, Grant No. 1R21CA240185-01).
</details>
